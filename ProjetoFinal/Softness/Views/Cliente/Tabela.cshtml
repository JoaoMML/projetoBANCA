<section class="content-header">
    <h1>
        Tabela de Usuários
        <small> - </small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="/Home/Index"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Tabelas</a></li>
        <li class="active">Usuarios</li>
    </ol>
</section>

<section class="content">
    <div class="box">
        <div class="box-header with-border">

            <div class=" margin-bottom text-right">
                <a type="button" href="/Cliente/Form" id="novo" name="cadastrar" class="btn btn-success">Novo</a>
                <button type="button" id="editar" name="editar" class="btn bg-blue-active">Editar</button>
                <button type="button" id="excluir" name="excluir" class="btn btn-google">Excluir</button>
            </div>



            <table id="tabelaUsuarios" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Cliente</th>
                        <th>Nome De Usuário</th>
                        <th>Senha</th>
                        <th>CPF</th>
                        <th>RG</th>
                        <th>Email</th>
                        <th>Telefone</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

</section>

@section Index_scripts{

    <script type="text/javascript">

        $(document).ready(function () {
            var tabelaUsuarios = $('#tabelaUsuarios').DataTable({
                dom: 'Blftip',
                select: { style: 'single' },
                "ajax": {
                    "url": "/Cliente/ListaClientes",
                    "type": "GET",
                    "datatype": "json",
                },
                "columns": [

                    { "data": "Id", "autoWidth": true },
                    { "data": "Pessoa.Nome", "autoWidth": true },
                    { "data": "NomeUsuario", "autoWidth": true },
                    { "data": "Senha", "autoWidth": true },
                    { "data": "Pessoa.Cpf", "autoWidth": true },
                    { "data": "Pessoa.Rg", "autoWidth": true },
                    { "data": "Pessoa.Email", "autoWidth": true },
                    { "data": "Pessoa.Fone", "autoWidth": true },
                ]
            });

            $('#editar').click(function () {
                var ClienteId = tabelaUsuarios.rows({ selected: true }).data()[0].Id;
                window.location.href = "/Cliente/EditaCliente/" + ClienteId
            });

            // Excluir Cliente no banco de dados e da DataTable
            $('#excluir').click(function () {
                var clienteId = tabela.rows({ selected: true }).data()[0].Id;
                $.ajax({
                    type: "GET",
                    url: "/Cliente/ExcluirCliente/" + clienteId,
                    dataType: "json",
                    success: function (response) {
                        if (response.excluiu) {
                            alert("Cliente apagado!");
                            tabela.ajax.reload();
                        }
                    }
                });
            });
        });
    </script>

}